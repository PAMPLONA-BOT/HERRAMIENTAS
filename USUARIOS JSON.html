<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Convertidor Excel a JSON (Todo como Texto)</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <style>
    :root {
      --primary-color: #0d6efd; --primary-hover: #0b5ed7; --secondary-color: #6c757d;
      --secondary-hover: #5c636a; --success-color: #198754; --danger-color: #dc3545;
      --light-gray: #f8f9fa; --border-color: #dee2e6; --text-color: #212529;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f0f2f5; color: var(--text-color); display: flex;
      justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px;
    }

    .main-container {
      background-color: #ffffff; padding: 40px; border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); width: 100%; max-width: 800px; text-align: center;
    }
    
    h1 { margin-top: 0; margin-bottom: 10px; font-size: 2rem; }
    
    .subtitle {
      color: var(--secondary-color); margin-bottom: 30px; font-size: 1.1rem;
      max-width: 600px; margin-left: auto; margin-right: auto;
    }
    
    /* Zonas que se muestran u ocultan */
    .hidden { display: none !important; }

    #upload-area { border: 3px dashed var(--border-color); border-radius: 12px; padding: 40px; cursor: pointer; transition: all 0.3s ease; }
    #upload-area.drag-over { border-color: var(--primary-color); background-color: #e9f5ff; }
    #file-input { display: none; }
    .upload-icon { width: 50px; height: 50px; margin-bottom: 15px; opacity: 0.6; color: var(--primary-color); }
    .upload-text { font-size: 1.1rem; font-weight: 500; color: var(--secondary-color); pointer-events: none; }
    .upload-text span { color: var(--primary-color); font-weight: 700; }

    #progress-area { padding: 40px; text-align: center; }
    #progress-bar { width: 100%; -webkit-appearance: none; appearance: none; }
    #progress-bar[value]::-webkit-progress-bar { background-color: #eee; border-radius: 4px; }
    #progress-bar[value]::-webkit-progress-value { background-color: var(--primary-color); border-radius: 4px; transition: background-color 0.3s; }
    #progress-text { font-weight: 600; margin-top: 15px; color: var(--secondary-color); }

    #results-area .file-info {
      background-color: var(--light-gray); border: 1px solid var(--border-color); border-radius: 8px;
      padding: 15px 20px; margin-bottom: 20px; text-align: left;
      display: flex; align-items: center; justify-content: space-between;
    }
    #file-name { font-weight: 600; }
    #json-output {
      width: 100%; height: 350px; border: 1px solid var(--border-color); border-radius: 8px;
      padding: 15px; font-family: "SF Mono", "Courier New", monospace; font-size: 14px;
      white-space: pre; overflow: auto; background-color: var(--light-gray); box-sizing: border-box;
    }
    .button-group { margin-top: 20px; display: flex; gap: 15px; justify-content: flex-end; }

    .btn {
      padding: 12px 25px; border: none; border-radius: 8px; font-size: 1rem;
      font-weight: 600; cursor: pointer; transition: all 0.2s ease;
    }
    .btn:active { transform: scale(0.97); }
    .btn-primary { background-color: var(--primary-color); color: white; }
    .btn-primary:hover { background-color: var(--primary-hover); }
    .btn-secondary { background-color: var(--secondary-color); color: white; }
    .btn-secondary:hover { background-color: var(--secondary-hover); }
    .btn-success { background-color: var(--success-color); color: white; }
    .btn-outline { background-color: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); padding: 10px 20px; }
    .btn-outline:hover { background-color: var(--primary-color); color: white; }

    .alert-box {
      padding: 15px; margin-top: 20px; border-radius: .25rem; color: #721c24;
      background-color: #f8d7da; border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>

  <div class="main-container">
    <h1>Convertidor Rápido de Excel a JSON</h1>
    <p class="subtitle">Sube tu archivo para convertir las columnas A-H. Todos los datos se convertirán a texto.</p>
    
    <label for="file-input" id="upload-area">
      <input type="file" id="file-input" accept=".xlsx, .xls, .csv">
      <svg class="upload-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg>
      <p class="upload-text">Arrastra y suelta un archivo aquí o <span>haz clic para buscar</span></p>
    </label>

    <div id="progress-area" class="hidden">
      <progress id="progress-bar"></progress>
      <p id="progress-text">Procesando archivo...</p>
    </div>

    <div id="results-area" class="hidden">
      <div class="file-info">
        <span id="file-name"></span>
        <button id="reset-btn" class="btn btn-outline">Cargar Otro</button>
      </div>
      <textarea id="json-output" readonly></textarea>
      <div class="button-group">
        <button id="copy-btn" class="btn btn-secondary">Copiar</button>
        <button id="download-btn" class="btn btn-primary">Descargar .json</button>
      </div>
    </div>
    
    <div id="alert-container"></div>
  </div>

<script>
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    const progressArea = document.getElementById('progress-area');
    const resultsArea = document.getElementById('results-area');
    const alertContainer = document.getElementById('alert-container');
    const fileNameDisplay = document.getElementById('file-name');
    const jsonOutput = document.getElementById('json-output');
    const copyBtn = document.getElementById('copy-btn');
    const downloadBtn = document.getElementById('download-btn');
    const resetBtn = document.getElementById('reset-btn');

    let generatedJsonString = '';
    let processedFileName = 'datos';

    // --- MANEJO DE EVENTOS ---
    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('drag-over'); });
    ['dragleave', 'dragend'].forEach(type => uploadArea.addEventListener(type, () => uploadArea.classList.remove('drag-over')));
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length) handleFile(e.target.files[0]);
    });

    // --- LÓGICA PRINCIPAL ---
    function handleFile(file) {
      showProgress();
      
      setTimeout(() => {
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

            // --- ESTA ES LA LÍNEA CORREGIDA ---
            // Transforma cada celda a un string para asegurar que todo tenga comillas.
            const processedData = jsonData.map(row => {
                if (!Array.isArray(row)) return []; // Ignora filas no válidas
                
                // 1. Corta la fila para obtener solo las columnas A-H
                const slicedRow = row.slice(0, 8);
                
                // 2. Convierte CADA celda a string. Las celdas vacías (null) se vuelven ""
                return slicedRow.map(cell => (cell === null || cell === undefined) ? "" : String(cell));
            })
            // Filtra las filas que hayan quedado completamente vacías después de la conversión
            .filter(row => row.length > 0 && row.some(cell => cell.trim() !== ''));

            generatedJsonString = JSON.stringify(processedData, null, 2);
            processedFileName = file.name.replace(/\.[^/.]+$/, "");
            
            showResults(file.name);
          } catch (error) {
            console.error("Error de procesamiento:", error);
            showError("El archivo parece estar corrupto o no es un formato de Excel válido.");
          }
        };
        reader.onerror = () => {
          console.error("Error de lectura de archivo.");
          showError("No se pudo leer el archivo. Inténtalo de nuevo.");
        };
        reader.readAsArrayBuffer(file);
      }, 50);
    }

    // --- MANEJO DE BOTONES ---
    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([generatedJsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${processedFileName}.json`;
      document.body.appendChild(a);
      a.click();
      URL.revokeObjectURL(url);
      document.body.removeChild(a);
    });

    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(jsonOutput.value).then(() => {
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '¡Copiado!';
        copyBtn.classList.add('btn-success');
        setTimeout(() => {
          copyBtn.textContent = originalText;
          copyBtn.classList.remove('btn-success');
        }, 2000);
      });
    });

    resetBtn.addEventListener('click', resetInterface);

    // --- FUNCIONES DE INTERFAZ (UI) ---
    function showProgress() {
      clearAlert();
      uploadArea.classList.add('hidden');
      resultsArea.classList.add('hidden');
      progressArea.classList.remove('hidden');
    }

    function showResults(fileName) {
      progressArea.classList.add('hidden');
      fileNameDisplay.textContent = `Archivo: ${fileName}`;
      jsonOutput.value = generatedJsonString;
      resultsArea.classList.remove('hidden');
    }

    function showError(message) {
      progressArea.classList.add('hidden');
      alertContainer.innerHTML = `<div class="alert-box">${message}</div>`;
      uploadArea.classList.remove('hidden');
    }

    function clearAlert() {
      alertContainer.innerHTML = '';
    }

    function resetInterface() {
      clearAlert();
      fileInput.value = null;
      resultsArea.classList.add('hidden');
      progressArea.classList.add('hidden');
      uploadArea.classList.remove('hidden');
    }
</script>

</body>
</html>